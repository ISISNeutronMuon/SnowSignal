stages:
  - test
  - build

Run unittests:
    stage: test
    image: python:latest
    script:
      - python --version
      - pip install -r src/requirements.txt
      - pip install -r test/requirements.txt
      - python -m coverage run --source=. -m unittest discover
      - coverage report
      - coverage xml
    coverage: '/TOTAL.*\s+(\d+\%)/'
    artifacts:
      when: always
      reports:
        coverage_report:
          coverage_format: cobertura
          path: ./coverage.xml

Rebuild Image: 
    stage: build
    when: on_success
    image: docker
    variables:
      DOCKER_TAG: $CI_COMMIT_REF_NAME
    
    services:
      - docker:dind
    script:
      - echo $NAME
      - docker build -t snowsignal src